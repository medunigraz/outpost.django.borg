{% extends "outpost/base.html" %}

{% load i18n %}
{% load humanize %}
{% load static %}

{% block content %}
<div class="page-header">
  <h1>
    {% blocktrans with name=repository.name %}
    Repository {{ name }}
    {% endblocktrans %}
  </h1>
</div>
<h3>
  {% trans "How to set up your backup" %}
</h3>
<hr/>
<div id="tutorial">
  <div class="progress">
    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="1" aria-valuemin="1" aria-valuemax="5" style="width: 20%;">
      Step 1 of 5
    </div>
  </div>

  <div class="navbar">
    <div class="navbar-inner">
      <ul class="nav nav-pills" role="tablist">
        <li class="active"><a href="#step1" data-toggle="tab" role="tab" data-step="1">Step 1: SSH Connection</a></li>
        <li><a href="#step2" data-toggle="tab" role="tab" data-step="2">Step 2: Initialization</a></li>
        <li><a href="#step3" data-toggle="tab" role="tab" data-step="3">Step 3: Backup</a></li>
        <li><a href="#step4" data-toggle="tab" role="tab" data-step="4">Step 4: Verify</a></li>
        <li><a href="#step5" data-toggle="tab" role="tab" data-step="5">Step 5: Clean up</a></li>
      </ul>
    </div>
  </div>
  <div class="tab-content">
    <div class="tab-pane fade in active" id="step1">
      <div class="well"> <h2>Step 1: SSH Connection</h2> Add another step here..</div>
      <a class="btn btn-default next" href="#">Continue</a>
    </div>
    <div class="tab-pane fade" id="step2">
      <div class="well"> <h2>Step 2: Initialization</h2> Add another step here..</div>
      <a class="btn btn-default next" href="#">Continue</a>
    </div>
    <div class="tab-pane fade" id="step3">
      <div class="well">
        <h2>Step 3: Backup</h2>
        {% blocktrans %}
        You can use this repository to backup your data by calling Borg backup:
        {% endblocktrans %}
        <pre><code>borg create --json --stats {{ object.server.username }}@{{ object.server.host.name }}:{{ object.server.path }}/{{ object.name}}::'{hostname}-{now}' [paths] |curl -H "Content-Type: application/json" -X POST -d @- {{ request.scheme }}://{{ request.get_host }}{% url "borg:repository-status-update" secret=object.secret %}</code></pre>
        {% blocktrans %}
        If you do not want to use the monitoring functionality of our services, simply omit the <code>curl</code>-Call.
        {% endblocktrans %}
      </div>
      <a class="btn btn-default next" href="#">Continue</a>
    </div>
    <div class="tab-pane fade" id="step4">
      <div class="well"> <h2>Step 4: Verify</h2> Add another almost done step here..</div>
      <a class="btn btn-default next" href="#">Continue</a>
    </div>
    <div class="tab-pane fade" id="step5">
      <div class="well"> <h2>Step 5: Clean up</h2> You're Done!</div>
    </div>
  </div>
</div>
<hr>
<table class="table table-striped">
  <thead>
    <tr>
      <th>{% trans "Name" %}</th>
      <th>{% trans "Start" %}</th>
      <th>{% trans "End" %}</th>
      <th>{% trans "Duration" %}</th>
      <th>{% trans "Files" %}</th>
      <th>{% trans "Size" %}</th>
      <th>{% trans "Compressed" %}</th>
      <th>{% trans "Deduplicated" %}</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for archive in object.archive_set.all %}
    <tr>
      <th scope="row">
        {{ archive.name }}
      </th>
      <td>{{ archive.start |date:"SHORT_DATETIME_FORMAT" }}</td>
      <td>{{ archive.end |date:"SHORT_DATETIME_FORMAT" }}</td>
      <td>{{ archive.duration }}</td>
      <td>{{ archive.files |intcomma }}</td>
      <td>{{ archive.raw |filesizeformat }}</td>
      <td>
        <div class="progress">
          <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="{{ archive.compression_ratio |floatformat:3 }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ archive.compression_ratio |floatformat:0}}%;">
            {{ archive.compression_ratio |floatformat:3 }}% ({{ archive.compressed |filesizeformat }})
          </div>
        </div>
      </td>
      <td>
        <div class="progress">
          <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{ archive.deduplication_ratio |floatformat:3 }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ archive.deduplication_ratio |floatformat:0}}%;">
            {{ archive.deduplication_ratio |floatformat:3 }}% ({{ archive.deduplicated |filesizeformat }})
          </div>
        </div>
      </td>
      <td>
        <a href="">
          <span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span>
        </a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block script %}
{{ block.super }}
<script src="{% static 'borg/detail.js' %}"></script>
{% endblock %}
